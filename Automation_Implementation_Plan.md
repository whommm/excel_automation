# 库存批量修改自动化实施计划书

## 1. 项目背景与目标
**当前痛点**：
目前库存修改工作依赖人工操作，流程繁琐（Excel复制 -> 系统查询 -> 批量修改 -> 填数 -> 确认）。重复性高，耗时且容易产生人为录入错误。

**项目目标**：
构建一套轻量级自动化工具（RPA），代替人工完成“从 Excel 读取数据并录入业务系统”的全过程。

**预期收益**：
- **效率提升**：预计比人工操作快 3-5 倍。
- **解放人力**：实现“无人值守”运行，人员可并行处理其他工作。
- **准确性**：杜绝人工复制粘贴时的错行、漏行风险。

---

## 2. 技术方案选型
鉴于业务系统为桌面端软件（非网页）且无 API 接口，采用 **UI 自动化模拟（RPA）** 方案。

*   **核心工具**：Python + PyAutoGUI
*   **技术原理**：
    1.  **数据源**：使用 `pandas` 库读取 Excel 文件。
    2.  **视觉识别**：使用 `OpenCV` 图像识别技术，自动在屏幕上寻找“查询”、“修改”等按钮的位置。
    3.  **模拟操作**：使用 `pyautogui` 模拟鼠标点击和键盘输入。

---

## 3. 实施步骤详解

### 阶段一：环境准备 (Pre-requisites)
1.  **硬件环境**：
    - 一台运行业务软件的 Windows 电脑。
    - 建议配备双屏（一边看运行日志，一边运行软件），单屏也可。
2.  **软件依赖**：
    - 安装 Python 3.x 环境。
    - 安装依赖库：`pandas`, `openpyxl` (读Excel), `pyautogui` (控制), `opencv-python` (图像识别), `pillow` (截图)。
3.  **关键素材采集**：
    - **截图**：对业务软件流程中的关键元素进行截图，保存为 `.png` 文件。
        - [ ] 查询输入框
        - [ ] 查询/搜索按钮
        - [ ] 批量修改按钮
        - [ ] 库存数量输入框
        - [ ] 确认/保存按钮

### 阶段二：脚本开发 (Development)
1.  **数据读取模块**：
    - 开发 Excel 读取功能，确保能正确解析“编码”和“库存数”两列数据。
    - 增加数据校验（如防止库存数为负，防止编码为空）。
2.  **自动化交互模块**：
    - 编写核心循环逻辑：查询 -> 等待 -> 点击修改 -> 填数 -> 保存。
    - **重点调试**：调整图像识别的灵敏度（Confidence），确保在不同分辨率下能找到按钮。
3.  **异常处理机制**：
    - **找不到目标时**：如果查不到该商品，脚本应记录日志并自动跳过，而不是卡死。
    - **系统卡顿时**：设置智能等待（Wait），直到界面加载完成再进行下一步。

### 阶段三：测试与验收 (Testing)
1.  **单元测试**：
    - 准备一份包含 5 条数据的测试 Excel。
    - 运行脚本，观察鼠标点击位置是否精准，输入内容是否正确。
2.  **压力测试**：
    - 准备 50-100 条数据。
    - 连续运行，观察是否存在内存泄漏或软件崩溃情况。
3.  **人工验收**：
    - 抽查系统内的库存数据，与 Excel 源数据进行比对，确保一致。

---

## 4. 风险评估与应对

| 风险点 | 描述 | 应对策略 |
| :--- | :--- | :--- |
| **识别失败** | 软件界面更新、分辨率改变导致找不到按钮 | 1. 重新截图更新素材库。<br>2. 备用方案：使用固定坐标点击（不够灵活但稳定）。 |
| **系统响应延迟** | 业务软件查询慢，脚本操作过快导致错位 | 1. 增加操作间隔时间（Sleep）。<br>2. 采用“检测到特定图片出现再操作”的智能等待模式。 |
| **脚本失控** | 程序逻辑错误导致鼠标乱点 | **安全熔断机制**：设置鼠标移动到屏幕角落即强制终止程序的保护功能。 |
| **电脑被占用** | 脚本运行时无法使用鼠标键盘 | 建议在午休或下班时间运行，或使用专用闲置电脑。 |

---

## 5. 维护指南
- **Excel 格式规范**：规定好 Excel 的列名必须为“编码”和“库存数”，不可随意更改。
- **素材更新**：如果业务软件升级换肤，需要重新截取按钮图片。

---

## 6. 附录：文件清单
- `main_bot.py`: 主程序代码。
- `requirements.txt`: 环境安装列表。
- `assets/`: 存放按钮截图的文件夹。
- `data/`: 存放待处理 Excel 的文件夹。
